# MSPaint Desktop 源码保护方案

## 🎯 目标
将项目打包成deb文件提供给外部使用，同时保护源码不被泄露。

## 🔒 保护方案

### 1. ASAR 归档打包
- **原理**: 将所有源码文件打包到二进制格式的 `app.asar` 文件中
- **效果**: 源码无法直接查看，即使提取出来也是压缩和混淆的代码
- **配置**: `"asar": true` 在 electron-builder 配置中启用

### 2. 最大压缩
- **原理**: 使用最高级别的压缩算法
- **效果**: 减小文件大小，增加逆向工程难度
- **配置**: `"compression": "maximum"`

### 3. 开发文件移除
- **移除内容**:
  - 测试文件 (`*.test.js`, `*.spec.js`)
  - 配置文件 (`.eslintrc`, `.prettierrc`)
  - 日志文件 (`*.log`)
  - 源码映射文件 (`*.map`)
  - 开发工具配置
- **配置**: 在 `files` 配置中使用排除模式

### 4. 后处理保护
- **自定义脚本**: `scripts/after-pack.js`
- **功能**: 进一步清理开发痕迹和调试信息

## 🚀 使用方法

### 快速构建（推荐）
```bash
./build-simple.sh
```

### 自定义构建
1. 修改 `package.json` 中的个人信息
2. 运行 `npm run dist:deb`

### 验证保护效果
```bash
# 检查ASAR文件
file dist/linux-unpacked/resources/app.asar

# 尝试提取（应该失败或得到混淆代码）
npx asar extract dist/linux-unpacked/resources/app.asar extracted/
```

## 📦 构建产物

构建完成后会生成：
- `mspaint-desktop_1.0.0_amd64.deb` - Debian/Ubuntu 安装包
- `MSPaint Desktop-1.0.0.AppImage` - AppImage 格式
- `linux-unpacked/` - 解压版本（用于测试）

## 🔧 安装方法

### DEB 包安装
```bash
sudo dpkg -i dist/mspaint-desktop_1.0.0_amd64.deb
sudo apt-get install -f  # 如果缺少依赖
```

### AppImage 安装
```bash
chmod +x "MSPaint Desktop-1.0.0.AppImage"
./"MSPaint Desktop-1.0.0.AppImage"
```

## 🛡️ 保护级别

### 高保护级别 ✅
- ASAR 归档打包
- 最大压缩
- 开发文件移除
- 后处理清理

### 中等保护级别 ⚠️
- 代码混淆（需要额外工具）
- 加密保护（需要额外配置）

### 低保护级别 ❌
- 仅压缩（不推荐）
- 无保护措施

## 📋 注意事项

### 法律合规
1. 确保源码保护措施符合当地法律法规
2. 注意原项目的开源许可证要求
3. 避免违反开源协议

### 技术考虑
1. 确保所有依赖正确包含
2. 在目标系统上测试打包后的应用
3. 考虑不同Linux发行版的兼容性

### 安全建议
1. 定期更新依赖包
2. 监控安全漏洞
3. 提供技术支持渠道

## 🔍 故障排除

### 构建失败
- 检查 Node.js 版本 (推荐 16+)
- 确保磁盘空间充足
- 检查网络连接（下载Electron）

### 应用无法启动
- 检查系统依赖
- 查看应用日志
- 确认权限设置

### 源码泄露风险
- 定期检查ASAR文件完整性
- 监控逆向工程工具
- 更新保护措施

## 📞 技术支持

如果遇到问题：
1. 检查构建日志
2. 验证系统环境
3. 确认配置正确性

---

**总结**: 使用 electron-builder + ASAR 归档是目前最有效且最常用的源码保护方案，能够有效防止普通用户查看源码，同时保持应用的正常运行。 